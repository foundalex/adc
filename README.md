
    Алгоритм наименьших квадратов для калибровки Time Interleaved ADC

1. Исходим из того, что АЦП0 принимается как референсный АЦП [1] Формула (1)
2. Задерживаем выходной сигнал АЦП0 для разных суб-АЦП на i/M. [1] (16) Таким образом мы представляем систему из M суб-АЦП как интерполированный сигнал с выхода АЦП0 в M раз
    Если система состоит из 4-ех суб-АЦП, то задержка на 0.25 равна 2-ому отсчету интерполированного сигнала с выхода АЦП0. На 0.5 - 3-ему, на 0.75 - 4-ому
3. Для того, чтобы задержать сигнал с выхода АЦП0 на i/M используется фильтр с дробной задержкой. Фильтр с дробной задержкой смещает входной сигнал на долю от частоты дискретизации Fs. В исходной статье используется метод задержки с помощью окна Блэкмэна [1] (Таблица 2) 
    3.1 В статье Fractional Delays Filters стр. 73 импульсная характеристика фильтра с дробной задержкой записывается как

        h(n) = sinc(n-D), 0 =< n <= N;  [2] Fractional Delays Filter. стр 73. Формула (3.33)
               0 otherwise;
        где n - номер отсчета. N - порядок фильтра. D - задержка фильтра. 

    Каузальный цифровой фильтр – фильтр, который работает в реальном масштабе времени и для которого выполняется условие причинности – выходной сигнал не может возникнуть раньше входного сигнала. 

        D = Dint - d, где d - дробная задержка. [1] Applications of fractional delay finite impulse response filters antenna system стр 2. Формула (2) 
        (N-1)/2 =< D <= (N+1)/2 - общая задержка должна быть в интервале. [2] Fractional Delays Filter. стр 73. Формула (3.34) 

        Dint - целая часть общей задержки должна быть равной половине длины фильтра. Для фильтров нечетного порядка Dint равен
        Dint = (N-1)/2, где N - порядок фильтра [2] Fractional Delays Filter. стр 73. Формула (3.35)

        Тогда получим импульсную характеристику
        h(n) = sinc(n-D) = sin (pi * (n-Dint-d)) / pi* (n-Dint-d);  n = 1...N;

        Умножаем на окно 
        h(n) = w(n-D)*sinc(n-D), for M =< n <= M+N, [2] Fractional Delays Filter. стр 75. Формула (3.39)
        М = round(D) - N/2, for even N
            floor(D) - (N-1)/2, for odd N
        w(n-D) - задержанная оконная функция

4. Из-за того, что данный фильтр ограничен частотой fc, то работать он будет в первой зоне Найквиста каждого суб АЦП. Чтобы иметь возможность работать в разных зонах всей АЦП системы применяется схема с однополосной АМ-модуляцией
    4.1 Необходимо получить ортогональный сигнал от исходного сигнала, для этого используется фильтр Гилберта. Импульсная характеристика фильтра [1] (33)

        h(n) = 2/pi * (sin((n*pi)/2))^2,    n!=0,
                0                           n = 0

    4.2 Так же при синтезе фильтра используется оконная функция Блэкмэна [1] (Таблица 2) 

        w(n) = 0.42 - 0.5*cos((2*pi*n)/L-1) + 0.08*cos((4*pi*n)/L-1)

    4.3 Затем сигнал модулируют с той же несущей и добавляют его в предыдущий сигнал https://docs.exponenta.ru/signal/ug/single-sideband-amplitude-modulation.html [1] Формула (29), (32)

5. Далее необходимо свести к минимуму ошибку между сигналом задержанным на различные значения с ADC0 и сигналами с выходов других суб-АЦП, т.е задержанный сигнал выступает в качестве референсного. [1] Формула (18)
    Для этого используется метод наименьших квадратов [1] Формула (19)

        h g,t,w (k) = ((y^T*y)^-1)*y^T*yri, где y - матрица входного сигнала размером Ls x N, где N - порядок фильтра. Ls - кол-во отсчетов, yri - референсный (задержанный) сигнал

    5.1 Полученные коэффициенты фильтра из формулы (19) необходимо подставить в FIR - фильтр N - го порядка. [3] стр. 194

Таким образом получается адаптивный фильтр, который обновляет коэффциенты с каждым новым отсчетом входного сигнала
    

Список литературы:
1. Hu.M, Yi.P, Digital Calibration for Gain, Time Skew, and Bandwidth Mismatch in Under-Sampling Time-Interleaved System 
2. Fractional Delays Filters 
3. В.И Джиган, Адаптивная фильтрация сигналов: теория и алгоритмы
4. Behrouz Farhang-Boroujeny, Adaptive Filters Theory and Applications


